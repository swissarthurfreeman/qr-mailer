package ch.hopitalrivierachablais.si.exploitation.mailer.service;

import java.util.Properties;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.JavaMailSenderImpl;
import org.springframework.stereotype.Service;

import ch.hopitalrivierachablais.si.exploitation.mailer.domain.model.Ticket;

@Service
public class MailService {
    
	@Value("${mailer.from.email}")
	private String fromEmail;

	@Value("${mailer.to.email}")
	private String toEmail;

	@Value("${mailer.host}")
	private String mailHost;

	@Value("${mailer.port}")
	private int mailPort;

    public JavaMailSender getJavaMailSender() {
		JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
		mailSender.setHost(mailHost);
		mailSender.setPort(mailPort);
		
		Properties props = mailSender.getJavaMailProperties();
		props.put("mail.transport.protocol", "smtp");
		return mailSender;
	}

    public void sendEmail(Ticket t) {
        SimpleMailMessage m = new SimpleMailMessage();
		m.setFrom(fromEmail);
		m.setTo(toEmail);
		m.setSubject("Test");
		m.setText(t.toString());

		JavaMailSender sender = getJavaMailSender();
		sender.send(m);
    }

    
}   
